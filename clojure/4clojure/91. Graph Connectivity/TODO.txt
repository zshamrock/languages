Try to solve the problem without using atom. 
Investigate on reduce/flatten instead or think different approach.
Union Find algorithm?
